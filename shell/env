#!/bin/sh

# Set variable identifying the chroot you work in (used in prompt)
if [ -z "${CHROOT_NAME:-}" ] && [ -r /etc/debian_chroot ]; then
    CHROOT_NAME=$(cat /etc/debian_chroot)
    export CHROOT_NAME
fi

# Determine OS (`uname` should be POSIX-safe)
# Expected results are Linux and Darwin
OS=$(uname)

# Try several different methods to determine the Linux distro
if [ "${OS}" = "Linux" ]; then
    # Check for the lsb_release command
    if [ -x "$(command -v lsb_release)" ]; then
        case "$(lsb_release --id --short)" in
            Ubuntu)
                DISTRO="Ubuntu" ;;
            Arch)
                DISTRO="Arch" ;;
            *)
                DISTRO="Unknown" ;;
        esac
    # Check for os-release (part of systemd)
    elif [ -r "/etc/os-release" ]; then
        # Match on the ID field of the os-release file
        case "$(grep "ID" /etc/os-release | cut -d = -f 2)" in
            arch)
                DISTRO="Arch" ;;
            ubuntu)
                DISTRO="Ubuntu" ;;
            *)
                DISTRO="Unknown" ;;
        esac
    # Try other /etc/*-release files (might want to expand the list)
    elif [ -f /etc/arch-release ]; then
        DISTRO="Arch"
    # Chrome OS has the /etc/lsb-release file, but not the lsb_release command
    elif ([ -f /etc/lsb-release ] && grep -q -i "chromeos" /etc/lsb-release); then
        DISTRO="ChromeOS"
    else
        DISTRO="Unknown"
    fi
fi

export OS
export DISTRO

EDITOR=vim
export EDITOR

if [ -z "$LESS" ]; then
    # Rundown of options:
    # i: ignore case when searching
    # M: more verbose prompt (like C-g)
    # q: ring the bell less often (causes hangs!)
    # R: output color sequences in raw form
    LESS=-iMR
    export LESS
fi

QT_STYLE_OVERRIDE=GTK+
export QT_STYLE_OVERRIDE

# Locale settings
LC_ALL=en_US.UTF-8
export LC_ALL
LANG=en_US.UTF-8
export LANG
LANGUAGE=en_US.UTF-8
export LANGUAGE

# Get ibus working
GTK_IM_MODULE=ibus
export GTK_IM_MODULE
XMODIFIERS=@im=ibus
export XMODIFIERS
QT_IM_MODULE=ibus
export QT_IM_MODULE

if [ "$OS" = "Linux" ]; then
    # Java settings
    # Forcing cross-platform look and feel may cause issues with GTK3 apps
    _JAVA_OPTIONS="-Dawt.useSystemAAFontSettings=on \
    -Dswing.aatext=true \
    -Dswing.defaultlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel \
    -Dswing.crossplatformlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel"
    export _JAVA_OPTIONS
fi

# Get non-interactive bash shells to use our functions
BASH_ENV="$HOME/.bashrc"
export BASH_ENV
